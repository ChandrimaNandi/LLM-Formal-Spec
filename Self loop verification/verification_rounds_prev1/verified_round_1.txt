Here is the corrected and verified version of the formal specifications.

---
### **State Variables**

Let `UserID`, `ComplaintID`, `InvitationID`, `OrderID`, `NotificationID`, `SessionID`, `SparePartID` be sets of identifiers.

**State Schema:**

*   `U`: A mapping from `UserID` to user records. A user record contains:
    *   `role`: {'customer', 'plumber', 'manager'}
    *   `privilege_level`: ℕ
    *   `email`: String
    *   `phone`: String
    *   `status`: {'active', 'pending_verification', 'requires_training', 'rejected', 'dismissed'}
    *   `specialties`: Set of String (for plumbers)
    *   `other_details`: String (for plumbers)
    *   `verification_result`: {'suitable', 'not suitable'} (for plumbers)
    *   `training_status`: {'pending', 'completed'} (for plumbers)
    *   `is_existing`: Boolean (for customers)
    *   *... and other user-related fields.*

*   `Complaints`: A mapping from `ComplaintID` to complaint records. A complaint record contains:
    *   `customerID`: `UserID`
    *   `status`: {'raised', 'assigned', 'processing', 'Under examination', 'completed', 'closed-satisfactory', 'closed-cancelled'}
    *   `assigned_plumber`: `UserID`
    *   `quotation`: QuotationDetails
    *   `quotation_status`: {'pending', 'approved', 'rejected'}
    *   `spares_approval_status`: {'pending', 'approved', 'rejected'}
    *   `plumber_response`: String
    *   `suggested_slots`: Set of DateTime
    *   `confirmed_slot`: DateTime
    *   `is_warranty`: Boolean
    *   `final_charges`: ChargeDetails
    *   *... and other complaint-related fields.*

*   `Invitations`: A set of invitation records. An invitation record contains:
    *   `inviter`: `UserID`
    *   `invitee_email`: String
    *   `privilege_level`: ℕ

*   `Orders`: A set of order records. An order record contains:
    *   `plumberID`: `UserID`
    *   `parts`: Set of `SparePartID`

*   `Warehouse`: A record representing warehouse state.
    *   `stock`: A mapping from `SparePartID` to quantity (ℕ).

*   `Notifications`: A set of notification records. A notification record contains:
    *   `recipient`: `UserID`
    *   `complaintID`: `ComplaintID`
    *   `content`: String

*   `Sessions`: A set of session records. A session record contains:
    *   `userID`: `UserID`

*   `SystemConfig`: A record for system-wide settings.
    *   `service_rates`: RateDetails

---
### **Initialization**

*   `U` = {`u_admin` ↦ an initial administrator user record}
*   `Complaints` = ∅
*   `Invitations` = ∅
*   `Orders` = ∅
*   `Warehouse` = (stock ↦ ∅)
*   `Notifications` = ∅
*   `Sessions` = ∅
*   `SystemConfig` = (service_rates ↦ default_rates)

---
### **Operations**

Operation: INVITE_USER_PRIVILEGE_OK
Preconditions:
u ∈ dom(U) ∧ U[u].privilege_level > p
Function:
invite_user(inviterID: u, invitee_email: i, privilege_level: p) → 201 Created
Postconditions:
∃ inv ∈ InvitationRecord ∧ inv.inviter = u ∧ inv.invitee_email = i ∧ inv.privilege_level = p ∧
Invitations' = Invitations ∪ {inv} ∧
U' = U ∧ Complaints' = Complaints ∧ Orders' = Orders ∧ Warehouse' = Warehouse ∧ Notifications' = Notifications ∧ Sessions' = Sessions ∧ SystemConfig' = SystemConfig

------------------------------------

Operation: DELETE_ACCOUNT_PRIVILEGE_OK
Preconditions:
u ∈ dom(U) ∧ a ∈ dom(U) ∧ U[u].privilege_level > U[a].privilege_level
Function:
delete_account(deleterID: u, accountID: a) → 200 OK
Postconditions:
U' = {a} ⩤ U ∧
Complaints' = Complaints ∧ Invitations' = Invitations ∧ Orders' = Orders ∧ Warehouse' = Warehouse ∧ Notifications' = Notifications ∧ Sessions' = Sessions ∧ SystemConfig' = SystemConfig

------------------------------------

Operation: MUST_BE_SIGNED_IN
Preconditions:
∃ s ∈ Sessions ∧ s.userID = u
Function:
perform_protected_action(userID: u, details: d) → 200 OK
Postconditions:
U' reflects successful action ∧
Complaints' = Complaints ∧ Invitations' = Invitations ∧ Orders' = Orders ∧ Warehouse' = Warehouse ∧ Notifications' = Notifications ∧ Sessions' = Sessions ∧ SystemConfig' = SystemConfig

------------------------------------

Operation: USER_SIGNIN_OK
Preconditions:
∃ u ∈ dom(U) ∧ verify_credentials(credentials, U[u])
Function:
signin(credentials: c) → 200 OK
Postconditions:
∃ s ∈ SessionRecord ∧ s.userID = u ∧
Sessions' = Sessions ∪ {s} ∧
U' = U ∧ Complaints' = Complaints ∧ Invitations' = Invitations ∧ Orders' = Orders ∧ Warehouse' = Warehouse ∧ Notifications' = Notifications ∧ SystemConfig' = SystemConfig

------------------------------------

Operation: SIGNUP
Preconditions:
details.role ∈ {'customer', 'plumber', 'manager'} ∧
details.email ≠ NULL ∧ details.phone ≠ NULL ∧
¬(∃ u ∈ dom(U) ∧ U[u].email = details.email) ∧
((details.role = 'plumber') ⇒ (details.specialties ≠ NULL ∧ details.other_details ≠ NULL))
Function:
signup(details: d) → 201 Created
Postconditions:
∃ u_new ∉ dom(U) ∧
let user_rec = (role ↦ details.role, email ↦ details.email, phone ↦ details.phone, status ↦ (if details.role = 'plumber' then 'pending_verification' else 'active'), specialties ↦ (if details.role = 'plumber' then details.specialties else ∅), ...) in
U' = U ∪ {u_new ↦ user_rec} ∧
Complaints' = Complaints ∧ Invitations' = Invitations ∧ Orders' = Orders ∧ Warehouse' = Warehouse ∧ Notifications' = Notifications ∧ Sessions' = Sessions ∧ SystemConfig' = SystemConfig

------------------------------------

Operation: RAISE_COMPLAINT
Preconditions:
c ∈ dom(U) ∧ U[c].role = 'customer' ∧ has_essential_info(details)
Function:
raise_complaint(customerID: c, details: d) → 201 Created
Postconditions:
∃ c_new ∉ dom(Complaints) ∧
let complaint_rec = (customerID ↦ c, details ↦ d, status ↦ 'raised', ...) in
Complaints' = Complaints ∪ {c_new ↦ complaint_rec} ∧
U' = U ∧ Invitations' = Invitations ∧ Orders' = Orders ∧ Warehouse' = Warehouse ∧ Notifications' = Notifications ∧ Sessions' = Sessions ∧ SystemConfig' = SystemConfig

------------------------------------

Operation: ASSIGN_COMPLAINT
Preconditions:
m ∈ dom(U) ∧ U[m].role = 'manager' ∧ p ∈ dom(U) ∧ U[p].role = 'plumber' ∧ U[p].status = 'active' ∧ cID ∈ dom(Complaints) ∧ Complaints[cID].status = 'raised'
Function:
assign_complaint(managerID: m, plumberID: p, complaintID: cID) → 200 OK
Postconditions:
Complaints' = Complaints ⊕ {cID ↦ (Complaints[cID] with assigned_plumber ↦ p, suggested_slots ↦ calculate_slots(p, cID), status ↦ 'assigned')} ∧
∃ n_p, n_c ∈ NotificationRecord ∧
n_p.recipient = p ∧ n_p.complaintID = cID ∧
n_c.recipient = Complaints[cID].customerID ∧ n_c.content = U[p].other_details ∧
Notifications' = Notifications ∪ {n_p, n_c} ∧
U' = U ∧ Invitations' = Invitations ∧ Orders' = Orders ∧ Warehouse' = Warehouse ∧ Sessions' = Sessions ∧ SystemConfig' = SystemConfig

------------------------------------

Operation: PLUMBER_VIEW_ASSIGNED_COMPLAINT_OK
Preconditions:
p ∈ dom(U) ∧ U[p].role = 'plumber' ∧ c ∈ dom(Complaints) ∧ Complaints[c].assigned_plumber = p
Function:
view_complaint(plumberID: p, complaintID: c) → 200 OK
Postconditions:
U' = U ∧ Complaints' = Complaints ∧ Invitations' = Invitations ∧ Orders' = Orders ∧ Warehouse' = Warehouse ∧ Notifications' = Notifications ∧ Sessions' = Sessions ∧ SystemConfig' = SystemConfig

------------------------------------

Operation: PLUMBER_RESPOND_TO_COMPLAINT_OK
Preconditions:
p ∈ dom(U) ∧ U[p].role = 'plumber' ∧ c ∈ dom(Complaints) ∧ Complaints[c].status = 'assigned' ∧ Complaints[c].assigned_plumber = p
Function:
respond_to_complaint(plumberID: p, complaintID: c, response: r) → 200 OK
Postconditions:
Complaints' = Complaints ⊕ {c ↦ (Complaints[c] with plumber_response ↦ r, status ↦ 'processing')} ∧
U' = U ∧ Invitations' = Invitations ∧ Orders' = Orders ∧ Warehouse' = Warehouse ∧ Notifications' = Notifications ∧ Sessions' = Sessions ∧ SystemConfig' = SystemConfig

------------------------------------

Operation: CUSTOMER_SELECT_SLOT_OK
Preconditions:
cust ∈ dom(U) ∧ U[cust].role = 'customer' ∧ cID ∈ dom(Complaints) ∧ Complaints[cID].customerID = cust ∧ s ∈ Complaints[cID].suggested_slots
Function:
select_slot(customerID: cust, complaintID: cID, slot: s) → 200 OK
Postconditions:
Complaints' = Complaints ⊕ {cID ↦ (Complaints[cID] with confirmed_slot ↦ s)} ∧
U' = U ∧ Invitations' = Invitations ∧ Orders' = Orders ∧ Warehouse' = Warehouse ∧ Notifications' = Notifications ∧ Sessions' = Sessions ∧ SystemConfig' = SystemConfig

------------------------------------

Operation: REJECT_SLOTS_TRIGGERS_NEW_SUGGESTIONS
Preconditions:
cust ∈ dom(U) ∧ cID ∈ dom(Complaints) ∧ Complaints[cID].customerID = cust
Function:
reject_all_slots(customerID: cust, complaintID: cID) → 200 OK
Postconditions:
Complaints' = Complaints ⊕ {cID ↦ (Complaints[cID] with suggested_slots ↦ recalculate_slots(Complaints[cID].assigned_plumber, cID, Complaints[cID].suggested_slots))} ∧
U' = U ∧ Invitations' = Invitations ∧ Orders' = Orders ∧ Warehouse' = Warehouse ∧ Notifications' = Notifications ∧ Sessions' = Sessions ∧ SystemConfig' = SystemConfig

------------------------------------

Operation: REQUEST_NEW_PLUMBER_AND_SLOTS_OK
Preconditions:
cust ∈ dom(U) ∧ cID ∈ dom(Complaints) ∧ Complaints[cID].customerID = cust
Function:
request_new_plumber_and_slots(customerID: cust, complaintID: cID) → 200 OK
Postconditions:
∃ p_new ∈ dom(U) ∧ U[p_new].role = 'plumber' ∧ p_new ≠ Complaints[cID].assigned_plumber ∧
Complaints' = Complaints ⊕ {cID ↦ (Complaints[cID] with assigned_plumber ↦ p_new, suggested_slots ↦ calculate_slots(p_new, cID))} ∧
U' = U ∧ Invitations' = Invitations ∧ Orders' = Orders ∧ Warehouse' = Warehouse ∧ Notifications' = Notifications ∧ Sessions' = Sessions ∧ SystemConfig' = SystemConfig

------------------------------------

Operation: GENERATE_QUOTATION_POSSIBLE
Preconditions:
a ∈ dom(U) ∧ (U[a].role = 'plumber' ∨ U[a].role = 'manager') ∧ c ∈ dom(Complaints) ∧ Complaints[c].status = 'Under examination'
Function:
generate_quotation(actorID: a, complaintID: c, quote_details: qd) → 200 OK
Postconditions:
Complaints' = Complaints ⊕ {c ↦ (Complaints[c] with quotation ↦ qd, quotation_status ↦ 'pending')} ∧
U' = U ∧ Invitations' = Invitations ∧ Orders' = Orders ∧ Warehouse' = Warehouse ∧ Notifications' = Notifications ∧ Sessions' = Sessions ∧ SystemConfig' = SystemConfig

------------------------------------

Operation: CUSTOMER_APPROVE_QUOTATION
Preconditions:
c ∈ dom(Complaints) ∧ Complaints[c].status = 'processing' ∧ cust = Complaints[c].customerID ∧ Complaints[c].quotation_status = 'pending'
Function:
approve_quotation(customerID: cust, complaintID: c) → 200 OK
Postconditions:
Complaints' = Complaints ⊕ {c ↦ (Complaints[c] with quotation_status ↦ 'approved')} ∧
U' = U ∧ Invitations' = Invitations ∧ Orders' = Orders ∧ Warehouse' = Warehouse ∧ Notifications' = Notifications ∧ Sessions' = Sessions ∧ SystemConfig' = SystemConfig

------------------------------------

Operation: REJECT_SERVICE_DUE_TO_COST_OK
Preconditions:
c ∈ dom(Complaints) ∧ Complaints[c].customerID = cust ∧ Complaints[c].quotation_status = 'pending'
Function:
reject_service_due_to_cost(customerID: cust, complaintID: c) → 200 OK
Postconditions:
Complaints' = Complaints ⊕ {c ↦ (Complaints[c] with status ↦ 'closed-cancelled', quotation_status ↦ 'rejected')} ∧
U' = U ∧ Invitations' = Invitations ∧ Orders' = Orders ∧ Warehouse' = Warehouse ∧ Notifications' = Notifications ∧ Sessions' = Sessions ∧ SystemConfig' = SystemConfig

------------------------------------

Operation: PLUMBER_CAN_ORDER_SPARES
Preconditions:
p ∈ dom(U) ∧ U[p].role = 'plumber'
Function:
order_spares(plumberID: p, spare_parts: s) → 201 Created
Postconditions:
∃ new_order ∈ OrderRecord ∧ new_order.plumberID = p ∧ new_order.parts = s ∧
Orders' = Orders ∪ {new_order} ∧
U' = U ∧ Complaints' = Complaints ∧ Invitations' = Invitations ∧ Warehouse' = Warehouse ∧ Notifications' = Notifications ∧ Sessions' = Sessions ∧ SystemConfig' = SystemConfig

------------------------------------

Operation: PLUMBER_REQUEST_SPARES_APPROVAL_OK
Preconditions:
p ∈ dom(U) ∧ U[p].role = 'plumber' ∧ cID ∈ dom(Complaints) ∧ Complaints[cID].assigned_plumber = p
Function:
request_spares_approval(plumberID: p, complaintID: cID, spares_list: s) → 200 OK
Postconditions:
Complaints' = Complaints ⊕ {cID ↦ (Complaints[cID] with spares_approval_status ↦ 'pending')} ∧
U' = U ∧ Invitations' = Invitations ∧ Orders' = Orders ∧ Warehouse' = Warehouse ∧ Notifications' = Notifications ∧ Sessions' = Sessions ∧ SystemConfig' = SystemConfig

------------------------------------

Operation: CHECKOUT_SPARES_CUSTOMER_CONSENT_OK
Preconditions:
p ∈ dom(U) ∧ U[p].role = 'plumber' ∧ c ∈ dom(Complaints) ∧ Complaints[c].assigned_plumber = p ∧ Complaints[c].spares_approval_status = 'approved'
Function:
checkout_spares(plumberID: p, complaintID: c, spares: s) → 200 OK
Postconditions:
let stock' = Warehouse.stock ⊕ {part ↦ Warehouse.stock(part) - spares(part) | part ∈ dom(spares)} in
Warehouse' = Warehouse with stock ↦ stock' ∧
U' = U ∧ Complaints' = Complaints ∧ Invitations' = Invitations ∧ Orders' = Orders ∧ Notifications' = Notifications ∧ Sessions' = Sessions ∧ SystemConfig' = SystemConfig

------------------------------------

Operation: FINALIZE_CHARGES
Preconditions:
c ∈ dom(Complaints) ∧ Complaints[c].status = 'completed' ∧ a ∈ dom(U)
Function:
finalize_charges(actorID: a, complaintID: c) → 200 OK
Postconditions:
let charges = calculate_charges(Complaints[c], U[Complaints[c].customerID]) in
Complaints' = Complaints ⊕ {c ↦ (Complaints[c] with final_charges ↦ charges)} ∧
(U[Complaints[c].customerID].is_existing = true ∧ Complaints[c].is_warranty = true ⇒ charges.visit_fee = 0) ∧
(U[Complaints[c].customerID].is_existing = false ⇒ charges.visit_fee > 0) ∧
U' = U ∧ Invitations' = Invitations ∧ Orders' = Orders ∧ Warehouse' = Warehouse ∧ Notifications' = Notifications ∧ Sessions' = Sessions ∧ SystemConfig' = SystemConfig

------------------------------------

Operation: DEFINE_SERVICE_RATES_OK
Preconditions:
m ∈ dom(U) ∧ U[m].role = 'manager'
Function:
define_service_rates(managerID: m, new_rates: r) → 200 OK
Postconditions:
SystemConfig' = SystemConfig with service_rates ↦ r ∧
U' = U ∧ Complaints' = Complaints ∧ Invitations' = Invitations ∧ Orders' = Orders ∧ Warehouse' = Warehouse ∧ Notifications' = Notifications ∧ Sessions' = Sessions

------------------------------------

Operation: ACTIVATE_PLUMBER
Preconditions:
m ∈ dom(U) ∧ U[m].role = 'manager' ∧ p ∈ dom(U) ∧ U[p].role = 'plumber' ∧ (U[p].verification_result = 'suitable' ∨ U[p].training_status = 'completed')
Function:
activate_plumber(managerID: m, plumberID: p) → 200 OK
Postconditions:
U' = U ⊕ {p ↦ (U[p] with status ↦ 'active')} ∧
Complaints' = Complaints ∧ Invitations' = Invitations ∧ Orders' = Orders ∧ Warehouse' = Warehouse ∧ Notifications' = Notifications ∧ Sessions' = Sessions ∧ SystemConfig' = SystemConfig

------------------------------------

Operation: PROCESS_UNSUITABLE_VERIFICATION_OK
Preconditions:
m ∈ dom(U) ∧ U[m].role = 'manager' ∧ p ∈ dom(U) ∧ U[p].role = 'plumber' ∧ U[p].verification_result = 'not suitable' ∧ decision ∈ {'requires_training', 'rejected'}
Function:
process_unsuitable_verification(managerID: m, plumberID: p, decision: d) → 200 OK
Postconditions:
U' = U ⊕ {p ↦ (U[p] with status ↦ decision)} ∧
Complaints' = Complaints ∧ Invitations' = Invitations ∧ Orders' = Orders ∧ Warehouse' = Warehouse ∧ Notifications' = Notifications ∧ Sessions' = Sessions ∧ SystemConfig' = SystemConfig

------------------------------------

Operation: PLUMBER_REAPPLY_OK
Preconditions:
p ∈ dom(U) ∧ U[p].role = 'plumber' ∧ U[p].status = 'dismissed' ∧ meets_reapply_conditions(U[p])
Function:
reapply_plumber(plumberID: p) → 200 OK
Postconditions:
U' = U ⊕ {p ↦ (U[p] with status ↦ 'pending_verification')} ∧
Complaints' = Complaints ∧ Invitations' = Invitations ∧ Orders' = Orders ∧ Warehouse' = Warehouse ∧ Notifications' = Notifications ∧ Sessions' = Sessions ∧ SystemConfig' = SystemConfig

------------------------------------

Operation: PLUMBER_FEATURE_ACCESS_OK
Preconditions:
u ∈ dom(U) ∧ U[u].role = 'plumber'
Function:
access_plumber_feature(userID: u, feature_details: d) → 200 OK
Postconditions:
U' = U ∧ Complaints' = Complaints ∧ Invitations' = Invitations ∧ Orders' = Orders ∧ Warehouse' = Warehouse ∧ Notifications' = Notifications ∧ Sessions' = Sessions ∧ SystemConfig' = SystemConfig